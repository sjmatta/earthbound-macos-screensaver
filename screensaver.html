<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Earthbound Battle Backgrounds Screensaver</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      html, body {
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: #000;
      }
      canvas {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        image-rendering: pixelated;
        image-rendering: crisp-edges;
      }
    </style>
  </head>
  <body>
    <canvas id="main"></canvas>

    <!-- Minimal stub for History (used by utils.js parseFullscreen) -->
    <script>
      window.History = {
        Adapter: { bind: function() {} },
        pushState: function() {}
      };
    </script>

    <!-- Utils must load before index.js -->
    <script src="./vendor/assets/utils.js"></script>

    <!-- Main engine bundle -->
    <script src="./vendor/assets/index.js"></script>

    <!-- Screensaver auto-cycling -->
    <script>
      const CYCLE_INTERVAL = 60000; // 60 seconds
      const LAYER_COUNT = 327;

      function randomLayer() {
        return Math.floor(Math.random() * LAYER_COUNT);
      }

      function setRandomLayers() {
        if (typeof document.engine !== 'undefined' &&
            typeof document.BackgroundLayer !== 'undefined' &&
            typeof ROM !== 'undefined') {
          const l1 = randomLayer();
          const l2 = randomLayer();
          try {
            document.engine.layers[0] = new document.BackgroundLayer(l1, ROM);
            document.engine.layers[1] = new document.BackgroundLayer(l2, ROM);
          } catch(e) {
            console.error('Error setting layers:', e);
          }
        }
      }

      // Wait for engine to be fully initialized
      function startScreensaver() {
        if (typeof document.engine !== 'undefined' &&
            typeof document.BackgroundLayer !== 'undefined' &&
            typeof ROM !== 'undefined' &&
            document.engine.layers) {
          // Set initial random layers
          setRandomLayers();
          // Cycle every 60 seconds
          setInterval(setRandomLayers, CYCLE_INTERVAL);
        } else {
          setTimeout(startScreensaver, 200);
        }
      }

      // Start after a brief delay to let engine initialize
      setTimeout(startScreensaver, 500);
    </script>
  </body>
</html>
